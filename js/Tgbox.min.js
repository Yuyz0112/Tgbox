(function(b){var f=function(){var a=this;this.Mask=b('<div id="Tgbox-mask"></div>');this.Popup=b('<div id="Tgbox-popup"></div>');this.bodyNode=b(document.body);this.render();this.picArea=this.Popup.find("div.Tgbox-pic-area");this.pic=this.Popup.find("img.Tgbox-image");this.captionArea=this.Popup.find("div.Tgbox-caption");this.prevBtn=this.Popup.find("span.Tgbox-btn-prev-icon");this.nextBtn=this.Popup.find("span.Tgbox-btn-next-icon");this.currentIndex=this.Popup.find("p.Tgbox-index");this.closeBtn=this.Popup.find("span.Tgbox-btn-close");this.TgboxIndex=null;this.bodyNode.delegate(".js-Tgbox,*[data-role=Tgbox]","click",function(c){c.stopPropagation();a.initPopup(b(this))});this.Mask.click(function(){b("body").css("overflow","auto");b(this).fadeOut();a.Popup.fadeOut()});this.closeBtn.click(function(){b("body").css("overflow","auto");a.Mask.fadeOut();a.Popup.fadeOut()});this.prevBtn.click(function(c){b(this).hasClass("disabled")||(c.stopPropagation(),a.goTo("prev"))});this.nextBtn.click(function(c){b(this).hasClass("disabled")||(c.stopPropagation(),a.goTo("next"))});this.Popup.bind("mousewheel",function(c){c.stopPropagation();b("body").css("overflow","hidden");a.zoomPic(this)});this.Popup.bind("mousedown",function(a){var e=this,d=a.clientX,g=a.clientY,h=b(e).position().left,f=b(e).position().top-b(window).scrollTop();b("html").mousemove(function(a){b(e).css("left",h+a.clientX-d).css("top",f+a.clientY-g)})});this.Popup.bind("mouseup",function(){b("html").unbind("mousemove")})};f.prototype={zoomPic:function(a){var c=parseInt(a.style.zoom,10)||100,c=c+event.wheelDelta/20;0<c&&(a.style.zoom=c+"%");return!1},goTo:function(a){"next"==a?(this.index++,this.index>=b("#article .js-Tgbox").length&&this.nextBtn.addClass("disabled"),0!=this.index&&this.prevBtn.removeClass("disabled"),a=b("#article .js-Tgbox").eq(this.index-1).attr("src"),this.loadSize(a)):"prev"==a&&(this.index--,console.log(this.index),1>=this.index&&this.prevBtn.addClass("disabled"),this.index!=b("#article .js-Tgbox").length&&this.nextBtn.removeClass("disabled"),a=b("#article .js-Tgbox").eq(this.index-1).attr("src"),this.loadSize(a))},loadSize:function(a){var c=this;this.pic.css({width:"auto",height:"auto"}).hide();this.preLoadImg(a,function(){c.pic.attr("src",a);var b=c.pic.width(),d=c.pic.height();c.reSize(b,d)})},reSize:function(a,c){var e=this,d=b(window).width();winHeight=b(window).height();d=Math.min(d/(a+10),winHeight/(c+10),1);a*=d;c*=d;e.picArea.animate({width:a-10,height:c-10});e.Popup.animate({width:a,height:c,marginLeft:-a/2,top:(winHeight-c)/2},function(){e.pic.css({width:a-10,height:c-10}).fadeIn();e.captionArea.fadeIn()});this.currentIndex.text(this.index+"/"+b("#article .js-Tgbox").length)},preLoadImg:function(a,c){var b=new Image;b.src=a;window.ActiveXObject?b.onreadystatechange=function(){"complete"==this.readyState&&c()}:b.onload=function(){c()}},showTgbox:function(a,c){var e=this,d=b(window).width(),g=b(window).height(),f=g/2+10;this.captionArea.hide();this.Mask.fadeIn();this.Popup.fadeIn();this.picArea.css({width:d/2,height:g/2});this.Popup.css({width:d/2+10,height:g/2+10,marginLeft:-(d/2+10)/2,top:-f}).animate({top:(g-f)/2},function(){e.loadSize(a)});this.index=c;d=b("#article .js-Tgbox").length;1==this.index?(this.prevBtn.addClass("disabled"),this.nextBtn.removeClass("disabled"),1==d&&this.nextBtn.addClass("disabled")):this.index==d?(this.prevBtn.removeClass("disabled"),this.nextBtn.addClass("disabled")):(this.prevBtn.removeClass("disabled"),this.nextBtn.removeClass("disabled"))},initPopup:function(a){var b=a.attr("data-src");currentID=a.attr("data-index");this.showTgbox(b,currentID)},render:function(){this.Popup.html('<div class = "Tgbox-pic-area" ><img class = "Tgbox-image" src=""><div class = "Tgbox-btn-prev" ><span class = "Tgbox-btn-prev-icon" > </span> </div><div class = "Tgbox-btn-next" ><span class = "Tgbox-btn-next-icon" > </span> </div> <span class = "Tgbox-btn-close" > </span> </div><div class = "Tgbox-caption" ><p class = "Tgbox-index" > 0 / 0 </p></div>');this.bodyNode.append(this.Mask,this.Popup)}};window.TgBox=f})(jQuery);